<article class="post" id="post_{{ tweet.post_pk }}" mix-fade-in="5000">

    {% set avatar = tweet.user_avatar_path %}
    <img src="{% if avatar %}
                {% if avatar.startswith('uploads/') %}
                    {{ url_for('static', filename=avatar) }}
                {% else %}
                    {{ url_for('static', filename='images/' + avatar) }}
                {% endif %}
             {% else %}
                {{ url_for('static', filename='images/avatar_1.jpg') }}
             {% endif %}" alt="Profile" class="w-8 h-8 rounded-full">

    <div class="post-content">
        <div class="post-header">
            <span class="name">{{ tweet.user_first_name }} {{ tweet.user_last_name }}</span>
            <span class="handle">@{{ tweet.user_username }}</span> Â·
            <span class="time">{{ tweet.post_time or '1d' }}</span>
        </div>

        {% if tweet.post_message %}
        <p class="text">{{ tweet.post_message }}</p>
        {% endif %}

        {% if tweet.post_image_path %}
        {% set filename = tweet.post_image_path %}
        {% set is_video = filename.endswith(('.mp4', '.webm')) %}

        {% if is_video %}
        <video controls class="w-80 rounded-md mt-2">
            <source
                src="{{ filename.startswith('http') and filename or url_for('static', filename='uploads/' + filename) }}"
                type="video/mp4">
            Your browser does not support the video tag.
        </video>
        {% else %}
        <img src="{{ filename.startswith('http') and filename or url_for('static', filename='uploads/' + filename) }}"
            alt="Post media" class="w-80 rounded-md mt-2">
        {% endif %}
        {% endif %}

        <div class="post-actions">
            <span class="action comment-toggle" data-post="{{ tweet.post_pk }}">
                <i class="fa-regular fa-comment"></i> 12
            </span>
            <span class="action"><i class="fa-solid fa-retweet"></i> 5</span>

            {% if tweet.liked_by_user %}
            {% include "___button_unlike_tweet.html" %}
            {% else %}
            {% include "___button_like_tweet.html" %}
            {% endif %}

            <span class="action"><i class="fa-solid fa-chart-simple"></i> 230</span>
            <span class="action"><i class="fa-solid fa-share"></i></span>

            {% if tweet.post_user_fk == user.user_pk %}
            <button
                onclick="editPost('{{ tweet.post_pk }}', `{{ tweet.post_message|default('')|escape }}`)">Edit</button>
            <button onclick="deletePost('{{ tweet.post_pk }}')">Delete</button>
            {% endif %}
        </div>

        <div class="comments-container" id="comments_{{ tweet.post_pk }}">
            <form class="comment-form" action="{{ url_for('api_create_comment') }}" method="POST" mix-post
                data-post="{{ tweet.post_pk }}">
                <textarea name="comment" placeholder="Write a comment..." maxlength="250"
                    class="w-full pa-2 outline-1 outline-s-solid outline-c-gray:+50"></textarea>
                <button type="submit" mix-default="Comment" mix-await="Commenting..."
                    class="w-auto ml-auto mt-2 bg-c-black text-c-white py-2 px-12 rounded-xl">Comment</button>
            </form>
            <div class="comment-list"></div>
        </div>

    </div>
</article>